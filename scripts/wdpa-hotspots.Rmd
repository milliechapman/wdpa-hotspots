---
title: "wdpa"
author: "Millie Chapman"
date: "2/21/2020"
output: html_document
---

```{r setup, include=FALSE}
# load packages
library(tidyverse)
library(dplyr)
library(gridExtra)
library(ggmap)
library(ggpubr)
library(sf)
```

```{r}
wdpa<- st_read("../data/WDPA_Jul2020-shapefile0/WDPA_Jul2020-shapefile-polygons.shp")
```

```{r}
wdpa_usa <- wdpa %>% 
  filter(ISO3 == "USA")
```

```{r}
cpad <- st_read("../data/CPAD_2020a/CPAD_2020a_Units.shp")
cpad %>% filter(YR_EST >1990)%>% filter(MARINE ==0) %>% select(UNIT_ID)  %>%plot()
```

```{r}
cced <- st_read("../data/CCED_2020a/CCED_2020a.shp")
cced %>% filter(year_est >1990) %>% select(cced_id) %>% plot()
```

```{r}
sig_hab <- st_read("../data/Terrestrial_Significant_Habitats_Summary_-_ACE_[ds2721]-shp/Terrestrial_Significant_Habitats_Summary_-_ACE_[ds2721].shp")

sig_hab <- as.tibble(sig_hab) %>%
  select(Hex_ID, TerrHabRan, TerrHabTot)
```

```{r}
connectivity <- st_read("../data/Terrestrial_Connectivity_-_ACE_[ds2734]-shp/")
```

```{r}
connectivity %>% filter(County == "ALAMEDA") %>% select(OBJECTID) %>% plot()
sig_hab %>% filter(County == "ALAMEDA") %>% select(OBJECTID) %>% plot()

int %>%filter(County == "ALAMEDA") %>% select(geometry) %>% plot()
```

transform

```{r}
cced <- st_transform(cced, 4326)
cpad <- st_transform(cpad, 4326)
```

```{r}
int_c_pa <- as_tibble(st_intersection(connectivity, cpad))
int_c_pa %>% filter(County == "MONTEREY") %>% select(geometry) %>% plot()
ccedb<- st_buffer(cced, dist = 0)
int_c_ce <- as_tibble(st_intersection(connectivity, ccedb))
int_c_ce %>% filter(County == "ALAMEDA") %>% select(geometry) %>% plot()
```

```{r}
int_c_ce$ce_area<- st_area(int_c_ce$geometry)

int_c_pa$pa_area<- st_area(int_c_pa$geometry)
```

```{r}
paArea <- int_c_pa %>%
  group_by(Hex_ID) %>%  
  mutate(pa_area = as.numeric(pa_area)) %>%
  summarise(paArea = sum(pa_area))

ceArea <- int_c_ce %>%
  group_by(Hex_ID) %>%
  mutate(ce_area = as.numeric(ce_area)) %>%
  summarise(ceArea = sum(ce_area))
```

```{r}
all <- connectivity %>%
  full_join(ceArea) %>%
  full_join(paArea) 
 
all$tot_area <- st_area(all$geometry)

all <- all %>%
  mutate(tot_area = as.numeric(tot_area)) 

all <- all %>%
  full_join(sig_hab) %>%
  mutate(perc_pa = paArea/tot_area,
         perc_ce = ceArea/tot_area) %>%
  mutate(perc_pa = replace_na(perc_pa, 0),
         perc_ce = replace_na(perc_ce, 0))
```

```{r}
all %>% select(TerrHabTot, perc_pa, perc_ce) %>%
  group_by(TerrHabTot) %>%
  summarise(perc_pa = mean(perc_pa),
            perc_ce = mean(perc_ce))
```

```{r}
all %>% select(Connectivi, perc_pa, perc_ce) %>%
  group_by(Connectivi) %>%
  summarise(perc_pa = mean(perc_pa),
            perc_ce = mean(perc_ce))
```

```{r}

```

